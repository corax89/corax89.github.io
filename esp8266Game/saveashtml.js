function saveAsHtml(file, im) {
	var s = '<!DOCTYPE html><html><title>esp8266gameEngine</title><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"></head><body><div style="width:30em;margin:0 auto;"><canvas id="screen" width="256" height="256" style="width:30em;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;" onclick="sound.initAudio();timerstart=new Date().getTime();timertime=0;soundTimer = 0;run();" ondblclick="fullScr()"></canvas><div id="viewKeyboard">print on keyboard</div><div>key A - z, key B - x or space. Created width <a href="https://corax89.github.io/esp8266Game/index.html">ESP lge</a><br>click on screen for start <input type="checkbox" onclick="sound.rtttl.globalSound = this.checked" id="soundCheckbox" checked>sound</label></div></div><script>';
	s += 'var code=[' + file.join(',') + '];';
	s += 'function decompress(r){for(var e,f,n,o=[],s=0;s<r.length;)if(0==(128&r[s])){e=((127&r[s])<<8)+r[s+1],s+=2;for(var h=0;h<e;h++)o.push(r[s]),s++}else{e=(127&r[s])>>1,f=((1&r[s])<<8)+r[s+1],s+=2,n=o.length-f;for(h=0;h<e;h++)o.push(o[n+h])}return o}code=decompress(code);\n';
	s += 'var font=[' + font.join(',') + '];\n';
	s += (Sound + '\n' + Cpu + '\nvar timers = [];var cpu = new Cpu;cpu.init();').replace(/([^\/])\/\/[^\n]*/g, '').replace(/[\t ]+/g, ' ').replace(/\r/g, '').replace(/\n /g, '\n').replace(/,\n/g, ',').replace(/;\n/g, ';').replace(/\n\n/g, '\n').replace(/\}\n/g, '}').replace(/([\d)=\+\-\*<>%,\/;\]]) /g, function (s, d) {
		return d;
	});
	s += 'var timerId,display=new Display,sound=new Sound,cpuLostCycle=0,isRedraw=!0,bpalette=["#000000","#EDE3C7","#BE3746","#7FB8B5","#4A3E4F","#6EA76C","#273F68","#DEBB59","#B48D6C","#42595A","#C0624D","#333333","#777777","#8FAB62","#3ABFD1","#bbbbbb"],globalJKey=0,globalKey=0,palette=[],sprtpalette=[];function keyPressHandler(e){13==(globalKey=e.keyCode)&&(globalKey=10),e.preventDefault()}function keyDownHandler(e){switch(e.keyCode){case 38:case 87:globalJKey|=1;break;case 40:case 83:globalJKey|=2;break;case 37:case 65:globalJKey|=4;break;case 39:case 68:globalJKey|=8;break;case 88:case 32:globalJKey|=32;break;case 90:globalJKey|=16}e.preventDefault()}function keyUpHandler(e){switch(e.keyCode){case 38:case 87:globalJKey&=-2;break;case 40:case 83:globalJKey&=-3;break;case 37:case 65:globalJKey&=-5;break;case 39:case 68:globalJKey&=-9;break;case 88:case 32:globalJKey&=-33;break;case 90:globalJKey&=-17}e.preventDefault()}function Display(){var e,t,a,l=[],r=[],n=[],i=[],o=2,c=document.getElementById("screen"),s=!1,u=!1;function d(){e.textAlign="start",e.textBaseline="hanging",e.font=8*o+"px monospace",e.fillStyle="black",e.fillRect(0,0,t+20,a+20);for(var r=0;r<20480;r++)l[r]=0,n[r]=0,i[r]=0;cpuLostCycle+=2e3,e.fillStyle="black",e.fillRect(0,128*o,128*o,16*o),e.fillStyle="white";for(r=0;r<16;r++)palette[r]=bpalette[r],sprtpalette[r]=bpalette[r]}function f(e,t,a){cpuLostCycle+=1,t>=0&&t<128&&a>=0&&a<128&&(n[128*t+a]=e)}function y(e,t,a,r){var n,i;for(n=0;n<r;n++)for(i=0;i<r;i++)f(e,t+n,a+i),l[128*(t+n)+a+i]=15&e}function p(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}function b(e,t,a){return"#"+p(e)+p(t)+p(a)}return{init:function(){t=c.getBoundingClientRect().width,a=c.getBoundingClientRect().height,(e=c.getContext("2d")).imageSmoothingEnabled=!1,d()},reset:d,clearScreen:function(e){null==e&&(e=0);for(var t=0;t<20480;t++)l[t]=e,n[t]=e},drawLed:function(t){var a=527*(t>>11&31)+23>>6,l=259*(t>>5&63)+33>>6,r=527*(31&t)+23>>6;e.fillStyle=b(a,l,r),e.fillRect(0,0,128*o,16*o),e.fillRect(0,144*o,128*o,16*o)},char:function(e,t,a,l,r){for(var n=e.charCodeAt(0),i=0;i<5;i++)for(var o=font[5*n+i],c=0;c<8;c++,o>>=1)f(1&o?l:r,t+i,a+c)},updatePixel:function(e,t){n[128*e+t]=l[128*e+t]},drawPixel:f,drawSpritePixel:function(e,t,a){t>=0&&t<128&&a>=0&&a<128&&(r[128*t+a]=e)},plot:function(e,t,a){t>=0&&t<128&&a>=0&&a<128&&(f(e,t,a),l[128*t+a]=15&e)},largeplot:y,getPixel:function(e,t){return e>=0&&e<=127&&t>=0&&t<=127?l[128*e+t]:0},viewKeyboard:function(e){s=!0},redraw:function(){var t,a,l;for(s?(document.getElementById("viewKeyboard").style.display="block",s=0):document.getElementById("viewKeyboard").style.display="none",a=0;a<128;a++)for(l=0;l<128;l++)r[128*a+l]>0?(t=r[128*a+l],i[128*a+l]=t,e.fillStyle=sprtpalette[15&t],e.fillRect(a*o,l*o,o,o)):(n[128*a+l]!=i[128*a+l]||u)&&(i[128*a+l]=n[128*a+l],t=n[128*a+l],e.fillStyle=palette[15&t],e.fillRect(a*o,l*o,o,o));u=!1},changePalette:function(e,t){var a=527*(t>>11&31)+23>>6,l=259*(t>>5&63)+33>>6,r=527*(31&t)+23>>6;u=!0,e<16?palette[e]=b(a,l,r):e<32&&(sprtpalette[e-16]=b(a,l,r))},clearSprite:function(){for(var e=0;e<20480;e++)r[e]=0},drawIco:function(e){for(var t=0,a=0;a<16;a++)for(var l=0;l<24;l++)if(y((240&e[t])>>4,16+4*l,32+4*a,4),l++,y(15&e[t],16+4*l,32+4*a,4),++t>=e.length)return}}}function redraw(){setTimeout(function(){requestAnimationFrame(redraw),cpu.redrawParticle(),display.redraw(),cpu.setRedraw(),isRedraw=!0},48)}function run(){for(var e=0;e<8;e++)timers[e]-=16,timers[e]<=0&&(timers[e]=0);soundTimer-=16,soundTimer<=30&&(soundTimer=sound.playRtttl()),soundTimer>2e3&&(soundTimer=2e3);for(e=0;e<8e3;e++)cpu.step(),e+=cpuLostCycle,cpuLostCycle=0;isRedraw&&(display.clearSprite(),cpu.redrawSprite(),cpu.testSpriteCollision(0),isRedraw=!1),timertime+=16;var t=(new Date).getTime()-timerstart-timertime;clearTimeout(timerId),timerId=setTimeout(function(){run()},16-t)}function fullScr(){var e=document.getElementById("screen");e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen()}document.addEventListener("keydown",keyDownHandler,!1),document.addEventListener("keyup",keyUpHandler,!1),document.addEventListener("keypress",keyPressHandler,!1),display.init(),display.reset(),cpu.init(),cpu.load(code),redraw();';
	if (im.length > 1)
		s += 'var im=[' + im.join(',') + '];display.drawIco(im);';
	s += '</script></body></html>';
	return s;
}
