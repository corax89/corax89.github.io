function saveAsHtml(file, im) {
	var s = '<!DOCTYPE html><html><title>esp8266gameEngine</title><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><style>#screen{width: 100%;height: 30em;image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: -o-crisp-edges;image-rendering: pixelated;-ms-interpolation-mode: nearest-neighbor;}@media screen and (orientation: portrait) { #screen { height: 40em; }}@media all and (display-mode: fullscreen) {#screen { height: 100%; }}</style></head><body><div id="cont" style="max-width:30em;height:40em;margin: 0 auto;background-color:#fff;"><canvas id="screen" width="512" height="512" onclick="start()" ondblclick="fullScr()"></canvas><div id="viewKeyboard">print on keyboard</div><div>key A - z, key B - x or space. Created width <a href="https://corax89.github.io/esp8266Game/index.html">ESP lge</a><br>click on screen for start </div><input type="checkbox" onclick="sound.rtttl.globalSound=this.checked" id="soundCheckbox" checked>sound</label></div><script>';
	s += 'var code=[' + file.join(',') + '];';
	s += 'function decompress(r){for(var e,f,n,o=[],s=0;s<r.length;)if(0==(128&r[s])){e=((127&r[s])<<8)+r[s+1],s+=2;for(var h=0;h<e;h++)o.push(r[s]),s++}else{e=(127&r[s])>>1,f=((1&r[s])<<8)+r[s+1],s+=2,n=o.length-f;for(h=0;h<e;h++)o.push(o[n+h])}return o}code=decompress(code);\n';
	s += 'var font=[' + font.join(',') + '];\n';
	s += (Sound + '\n' + Cpu + '\nvar timers = [];var cpu = new Cpu;cpu.init();').replace(/([^\/])\/\/[^\n]*/g, '').replace(/[\t ]+/g, ' ').replace(/\r/g, '').replace(/\n /g, '\n').replace(/,\n/g, ',').replace(/;\n/g, ';').replace(/\n\n/g, '\n').replace(/\}\n/g, '}').replace(/([\d)=\+\-\*<>%,\/;\]]) /g, function (s, d) {
		return d;
	});
	s += 'var timerId,display=new Display,sound=new Sound,cpuLostCycle=0,isRedraw=!0,isRun=!1,bpalette=["#000000","#EDE3C7","#BE3746","#7FB8B5","#4A3E4F","#6EA76C","#273F68","#DEBB59","#B48D6C","#42595A","#C0624D","#333333","#777777","#8FAB62","#3ABFD1","#bbbbbb"],globalJKey=0,globalKey=0,palette=[],sprtpalette=[];function keyPressHandler(a){globalKey=a.keyCode,13==globalKey&&(globalKey=10),a.preventDefault()}function keyDownHandler(a){switch(a.keyCode){case 38:case 87:globalJKey|=1;break;case 40:case 83:globalJKey|=2;break;case 37:case 65:globalJKey|=4;break;case 39:case 68:globalJKey|=8;break;case 88:case 32:globalJKey|=32;break;case 90:globalJKey|=16;}a.preventDefault()}function keyUpHandler(a){switch(a.keyCode){case 38:case 87:globalJKey&=-2;break;case 40:case 83:globalJKey&=-3;break;case 37:case 65:globalJKey&=-5;break;case 39:case 68:globalJKey&=-9;break;case 88:case 32:globalJKey&=-33;break;case 90:globalJKey&=-17;}a.preventDefault()}function Display(){function a(){l=s.getBoundingClientRect().width,m=s.getBoundingClientRect().height,k=s.getContext("2d"),k.imageSmoothingEnabled=!1,b()}function b(){k.textAlign="start",k.textBaseline="hanging",k.font=8*r+"px monospace",k.fillStyle="black",k.fillRect(0,0,2*l,2*m);for(var a=0;20480>a;a++)n[a]=0,p[a]=0,q[a]=0;cpuLostCycle+=2e3,k.fillStyle="black",k.fillRect(0,512,128*r,64),k.fillStyle="white";for(var a=0;16>a;a++)palette[a]=bpalette[a],sprtpalette[a]=bpalette[a]}function c(a){k.fillStyle=j(527*(31&a>>11)+23>>6,259*(63&a>>5)+33>>6,527*(31&a)+23>>6),k.fillRect(0,0,128*pixelSize,16*pixelSize),k.fillRect(0,144*r,512,16*r)}function d(a,b,c){cpuLostCycle+=.1,b>=v&&b<w&&c>=z&&c<A&&(p[128*b+c]=a)}function e(a,b,c){b>=v&&b<w&&c>=z&&c<A&&(d(a,b,c),n[128*b+c]=15&a)}function f(a,b,c,e){var f,g;for(f=0;f<e;f++)for(g=0;g<e;g++)d(a,b+f,c+g),n[128*(b+f)+c+g]=15&a}function g(){var a=[8,143,24,130,24,156,40,143,90,150,110,135];k.strokeStyle="#fff";for(var b=0;8>b;b++)k.rect(a[2*b]*4,a[2*b+1]*r,48,12*r);k.stroke()}function h(){var a,b,c,d;for(t?(document.getElementById("viewKeyboard").style.display="block",t=0):document.getElementById("viewKeyboard").style.display="none",s.clientWidth+10<s.clientHeight?(r=3,g()):r=4,d=!1,(l!=s.getBoundingClientRect().width||m!=s.getBoundingClientRect().height)&&(l=s.getBoundingClientRect().width,m=s.getBoundingClientRect().height,g(),d=!0),b=0;128>b;b++)for(c=0;128>c;c++)0<o[128*b+c]?(a=o[128*b+c],q[128*b+c]=a,k.fillStyle=sprtpalette[15&a],k.fillRect(4*b,c*r,4,r)):(p[128*b+c]!=q[128*b+c]||u||d)&&(q[128*b+c]=p[128*b+c],a=p[128*b+c],k.fillStyle=palette[15&a],k.fillRect(4*b,c*r,4,r));u=!1}function i(a){var b=(+a).toString(16);return 2>b.length&&(b="0"+b),b}function j(a,c,d){var b=i(a),e=i(c),f=i(d);return"#"+b+e+f}var k,l,m,n=[],o=[],p=[],q=[],r=4,s=document.getElementById("screen"),t=!1,u=!1,v=0,w=128,z=0,A=128;return{init:a,reset:b,clearScreen:function(a){(a===void 0||null===a)&&(a=0);for(var b=0;20480>b;b++)n[b]=a,p[b]=a},drawLed:c,char:function(a,b,e,f,g){for(var h,k=a.charCodeAt(0),c=0;5>c;c++){h=font[5*k+c];for(var l=0;8>l;l++,h>>=1)1&h?d(f,b+c,e+l):d(g,b+c,e+l)}},updatePixel:function(a,b){p[128*a+b]=n[128*a+b]},drawPixel:d,drawSpritePixel:function(a,b,c){0<=b&&128>b&&0<=c&&128>c&&(o[128*b+c]=a)},plot:e,largeplot:f,getPixel:function(a,b){return 0<=a&&127>=a&&0<=b&&127>=b?n[128*a+b]:0},setClip:function(a,b,c,d){v=0<=a&&127>a?a:0,z=0<=b&&127>b?b:0,w=0<a+c&&128>=a+c?a+c:128,A=0<b+d&&128>=b+d?b+d:128},viewKeyboard:function(){t=!0},redraw:h,changePalette:function(a,c){var d=527*(31&c>>11)+23>>6,e=259*(63&c>>5)+33>>6,f=527*(31&c)+23>>6;u=!0,16>a?palette[a]=j(d,e,f):32>a&&(sprtpalette[a-16]=j(d,e,f))},clearSprite:function(){for(var a=0;20480>a;a++)o[a]=0},drawIco:function(a){for(var b=0,c=0;16>c;c++)for(var d=0;24>d;d++)if(f((240&a[b])>>4,16+4*d,32+4*c,4),d++,f(15&a[b],16+4*d,32+4*c,4),b++,b>=a.length)return}}}function redraw(){setTimeout(function(){requestAnimationFrame(redraw),cpu.redrawParticle(),display.redraw(),cpu.setRedraw(),isRedraw=!0},48)}function run(){for(var a=0;8>a;a++)timers[a]-=16,0>=timers[a]&&(timers[a]=0);soundTimer-=16,30>=soundTimer&&(soundTimer=sound.playRtttl()),2e3<soundTimer&&(soundTimer=2e3);for(var a=0;8e3>a;a++)cpu.step(),a+=cpuLostCycle,cpuLostCycle=0;isRedraw&&(display.clearSprite(),cpu.redrawSprite(),cpu.testSpriteCollision(0),isRedraw=!1),timertime+=16;var b=new Date().getTime()-timerstart-timertime;clearTimeout(timerId),timerId=setTimeout(function(){run()},16-b)}function fullScr(){var a=document.getElementById("cont");a.webkitRequestFullScreen?a.webkitRequestFullScreen():a.mozRequestFullScreen(),display.redraw()}window.addEventListener("load",function(){function a(a){var c=a.target.getBoundingClientRect(),e=a.targetTouches;start(),globalJKey=0;for(var f=0;f<e.length;f++)for(var g=parseInt(128*(e[f].clientX-c.left)/b.clientWidth),h=parseInt(160*(e[f].clientY-c.left)/b.clientHeight),k=0;8>k;k++)g>d[2*k]&&g<d[2*k]+10&&h>d[2*k+1]-10&&h<d[2*k+1]&&(globalJKey|=1<<k),100>h&&fullScr();a.preventDefault()}var b=document.getElementById("screen"),c=!!("ontouchstart"in window)||!!("ontouchstart"in document.documentElement)||!!window.ontouchstart||!!window.Touch||!!window.onmsgesturechange||window.DocumentTouch&&window.document instanceof window.DocumentTouch,d=[24,130,24,156,8,143,40,143,90,150,110,135];b.addEventListener("touchstart",a,!1),b.addEventListener("touchend",a,!1)},!1);function start(){isRun||(isRun=!0,sound.initAudio(),timerstart=new Date().getTime(),timertime=0,soundTimer=0,run())}document.addEventListener("keydown",keyDownHandler,!1),document.addEventListener("keyup",keyUpHandler,!1),document.addEventListener("keypress",keyPressHandler,!1),display.init(),display.reset(),cpu.init(),cpu.load(code),redraw();';
	if (im.length > 1)
		s += 'var im=[' + im.join(',') + '];display.drawIco(im);';
	s += '</script></body></html>';
	return s;
}
